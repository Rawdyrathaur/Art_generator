<!DOCTYPE html>
<html>
<head>
    <title>Image Processing Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #2a2a2a;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .image-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .image-box {
            flex: 1;
            text-align: center;
        }
        .image-box img {
            max-width: 100%;
            height: auto;
            border: 2px solid #64FFDA;
            border-radius: 10px;
        }
        .controls {
            margin: 20px 0;
            padding: 20px;
            background: #3a3a3a;
            border-radius: 10px;
        }
        .control-group {
            margin: 10px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #64FFDA;
        }
        select, input[type="range"], input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            background: #2a2a2a;
            color: white;
            border: 1px solid #64FFDA;
            border-radius: 5px;
        }
        button {
            background: linear-gradient(135deg, #64FFDA, #4DD0E1);
            color: #0A0A0B;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(100, 255, 218, 0.3);
        }
        #fileInput {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¨ Image Processing Test</h1>
        <p>Upload an image and test the various artistic transformations!</p>
        
        <input type="file" id="fileInput" accept="image/*">
        
        <div class="controls">
            <div class="control-group">
                <label for="toolSelect">Art Tool:</label>
                <select id="toolSelect">
                    <option value="photo-to-art">Photo to Art</option>
                    <option value="style-transfer">Style Transfer</option>
                    <option value="vintage-filter">Vintage Filter</option>
                    <option value="sketch-maker">Sketch Maker</option>
                    <option value="color-enhance">Color Enhance</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="styleSelect">Style:</label>
                <select id="styleSelect">
                    <option value="default">Default</option>
                    <option value="oil-painting">Oil Painting</option>
                    <option value="watercolor">Watercolor</option>
                    <option value="van-gogh">Van Gogh</option>
                    <option value="picasso">Picasso</option>
                    <option value="sepia">Sepia</option>
                    <option value="charcoal">Charcoal</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="intensitySlider">Intensity: <span id="intensityValue">7</span></label>
                <input type="range" id="intensitySlider" min="1" max="10" value="7">
            </div>
            
            <div class="control-group">
                <label for="promptInput">Custom Prompt:</label>
                <input type="text" id="promptInput" placeholder="e.g., warm colors, dreamy atmosphere">
            </div>
            
            <button onclick="processImage()">ðŸŽ¨ Transform Image</button>
            <button onclick="downloadResult()">ðŸ’¾ Download Result</button>
        </div>
        
        <div class="image-container">
            <div class="image-box">
                <h3>Original</h3>
                <img id="originalImage" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='100%25' height='100%25' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.35em' fill='%23666'%3EUpload an image%3C/text%3E%3C/svg%3E" alt="Upload an image">
            </div>
            <div class="image-box">
                <h3>Transformed</h3>
                <img id="processedImage" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='100%25' height='100%25' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.35em' fill='%23666'%3EProcessed image will appear here%3C/text%3E%3C/svg%3E" alt="Processed image">
            </div>
        </div>
        
        <div id="status" style="text-align: center; margin: 20px 0; color: #64FFDA;"></div>
    </div>

    <script>
        // Simplified version of the image processor for testing
        class SimpleImageProcessor {
            async processImage(dataUrl, tool, style, intensity, prompt) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;
                        
                        // Apply transformations based on tool and style
                        this.applyTransformation(data, tool, style, intensity, prompt);
                        
                        ctx.putImageData(imageData, 0, 0);
                        resolve(canvas.toDataURL('image/jpeg', 0.9));
                    };
                    img.src = dataUrl;
                });
            }
            
            applyTransformation(data, tool, style, intensity, prompt) {
                const factor = intensity / 10;
                
                for (let i = 0; i < data.length; i += 4) {
                    if (tool === 'vintage-filter' || style === 'sepia') {
                        // Sepia effect
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        data[i] = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
                        data[i + 1] = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
                        data[i + 2] = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
                    } else if (tool === 'sketch-maker' || style === 'charcoal') {
                        // Convert to grayscale sketch
                        const gray = 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];
                        const sketch = 255 - gray;
                        const final = gray * (1 - factor) + sketch * factor * 0.5;
                        
                        data[i] = final;
                        data[i + 1] = final;
                        data[i + 2] = final;
                    } else if (style === 'van-gogh') {
                        // Van Gogh swirls
                        const swirl = Math.sin(i * 0.01) * factor * 30;
                        data[i] = Math.max(0, Math.min(255, data[i] + swirl));
                        data[i + 1] = Math.max(0, Math.min(255, data[i + 1] + swirl * 0.8));
                        data[i + 2] = Math.max(0, Math.min(255, data[i + 2] + swirl * 1.2));
                    } else if (tool === 'color-enhance') {
                        // Enhance colors
                        data[i] = Math.min(255, data[i] * (1 + factor * 0.3));
                        data[i + 1] = Math.min(255, data[i + 1] * (1 + factor * 0.3));
                        data[i + 2] = Math.min(255, data[i + 2] * (1 + factor * 0.3));
                    } else {
                        // Default artistic effect
                        const noise = (Math.random() - 0.5) * factor * 20;
                        data[i] = Math.max(0, Math.min(255, data[i] + noise));
                        data[i + 1] = Math.max(0, Math.min(255, data[i + 1] + noise));
                        data[i + 2] = Math.max(0, Math.min(255, data[i + 2] + noise));
                    }
                    
                    // Apply prompt-based effects
                    if (prompt.toLowerCase().includes('warm')) {
                        data[i] = Math.min(255, data[i] * (1 + factor * 0.2));
                    }
                    if (prompt.toLowerCase().includes('cool')) {
                        data[i + 2] = Math.min(255, data[i + 2] * (1 + factor * 0.2));
                    }
                }
            }
        }

        const processor = new SimpleImageProcessor();
        let currentProcessedUrl = null;

        // Event listeners
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        document.getElementById('intensitySlider').addEventListener('input', function() {
            document.getElementById('intensityValue').textContent = this.value;
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('originalImage').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        async function processImage() {
            const originalImg = document.getElementById('originalImage');
            const processedImg = document.getElementById('processedImage');
            const status = document.getElementById('status');
            
            if (originalImg.src.includes('data:image/svg+xml')) {
                alert('Please upload an image first!');
                return;
            }

            const tool = document.getElementById('toolSelect').value;
            const style = document.getElementById('styleSelect').value;
            const intensity = parseInt(document.getElementById('intensitySlider').value);
            const prompt = document.getElementById('promptInput').value;

            status.textContent = 'Processing image...';
            
            try {
                const processedUrl = await processor.processImage(
                    originalImg.src, tool, style, intensity, prompt
                );
                
                processedImg.src = processedUrl;
                currentProcessedUrl = processedUrl;
                status.textContent = `âœ… Image processed successfully with ${tool} (${style}, intensity: ${intensity}/10)`;
            } catch (error) {
                status.textContent = 'âŒ Processing failed: ' + error.message;
                console.error('Processing error:', error);
            }
        }

        function downloadResult() {
            if (!currentProcessedUrl) {
                alert('No processed image to download!');
                return;
            }
            
            const link = document.createElement('a');
            link.href = currentProcessedUrl;
            link.download = `artify-processed-${Date.now()}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>